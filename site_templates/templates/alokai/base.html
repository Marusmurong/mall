<!DOCTYPE html>
{% load static %}
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ site_config.name }} - 精品商城{% endblock %}</title>
    
    <!-- 核心样式 (本地资源) -->
    <link rel="stylesheet" href="{% static 'css/core.css' %}">
    
    <!-- 站点主题样式 (本地资源) -->
    <link rel="stylesheet" href="{% static 'css/themes/' %}{{ site_config.theme }}.css">
    
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="{% static 'css/site-specific.css' %}">
    
    <!-- SEO优化 -->
    {% block meta %}{% endblock %}
    
    <!-- 站点配置 -->
    <script>
        window.siteConfig = {
            siteId: '{{ site_config.id }}',
            apiUrl: '{{ LOCAL_API_CONFIG.API_URL }}',
            token: '{{ DEFAULT_API_TOKEN }}',
            theme: '{{ site_config.theme }}',
            features: {{ site_config.features|safe }}
        };
    </script>
</head>
<body>
    <!-- 应用容器 -->
    <div id="app">
        <!-- 站点选择器 -->
        {% if user.is_staff %}
        <div class="site-selector">
            <button @click="showSiteModal = true">
                当前站点：{{ site_config.name }}
            </button>
        </div>
        {% endif %}

        <!-- 主内容区域 -->
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- 核心库 (本地资源) -->
    <script src="{% static 'js/core.js' %}"></script>
    
    <!-- 站点特定配置 (本地资源) -->
    <script src="{% static 'js/site-config.js' %}"></script>
    
    <!-- 初始化应用 -->
    <script>
        // 初始化平台
        const platform = new Platform(window.siteConfig);
        
        // 加载站点配置
        platform.loadSiteConfig()
            .then(config => {
                // 初始化主题
                platform.initTheme(config.theme);
                
                // 初始化路由
                platform.initRouter();
                
                // 初始化组件
                platform.initComponents();
            })
            .catch(error => {
                console.error('初始化失败:', error);
                // 显示错误页面
                platform.showErrorPage(error);
            });
    </script>
</body>
</html>
