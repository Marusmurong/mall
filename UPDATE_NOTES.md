# 亚马逊商品导入功能更新说明

## 版本: v1.0.0
## 日期: 2025-05-01

### 新增功能

1. **亚马逊商品数据导入系统**
   - 开发了智能导入脚本(`smart_import.py`)，支持批量导入亚马逊商品数据
   - 实现了基于商品标题、批次文件名和预定义类别的智能分类功能
   - 支持预览模式，在实际导入前查看商品数据和分类结果
   - 提供命令行参数，灵活控制导入过程和选项

2. **分类映射配置系统**
   - 创建分类映射配置文件(`category_mapping.py`)，建立亚马逊分类与系统分类的映射关系
   - 支持通过关键词、批次文件名和商品类别进行多级智能匹配
   - 包含30多种亚马逊采集分类到系统分类的映射规则

3. **商品分类管理工具**
   - 开发分类管理脚本(`organize_categories.py`)，支持创建和管理多级分类结构
   - 提供分类查看功能，便于了解现有分类体系
   - 支持将已有商品重新分配到正确的分类

### 改进和优化

1. **价格处理优化**
   - 增强价格处理逻辑，正确处理美元价格格式
   - 对空价格或无效价格情况进行默认处理，避免导入失败
   - 价格信息在导入过程中清晰显示，方便核对

2. **图片管理增强**
   - 完善图片导入逻辑，自动设置商品主图
   - 优化图片路径处理，支持不同批次的图片文件
   - 增加图片错误处理机制，提高导入稳定性

3. **批次处理能力**
   - 支持处理多个批次的商品数据文件
   - 按批次号排序处理，确保导入顺序一致
   - 提供限制每批次导入数量的选项，便于测试和分步导入

### 技术细节

1. **代码结构**
   - 采用模块化设计，将分类映射、导入逻辑和分类管理分离
   - 使用Django事务保证数据一致性，避免部分导入造成的数据问题
   - 实现详细的错误处理和日志记录，便于排查问题

2. **导入流程**
   - 预处理：读取JSON数据文件，分析商品信息
   - 分类判断：基于多种因素确定最合适的分类
   - 数据导入：创建商品记录，处理图片和其他属性
   - 结果报告：统计导入成功和失败的数量，提供详细报告

3. **版本控制**
   - 在GitHub上创建feature/amazon-import分支存放新功能
   - 完整提交历史记录开发过程和变更
   - 主要文件包括smart_import.py、category_mapping.py和organize_categories.py

### 使用指南

1. **智能导入脚本**
   ```bash
   # 列出所有可用的分类映射
   python smart_import.py --list-categories
   
   # 预览模式，不实际导入数据
   python smart_import.py --preview
   
   # 导入特定批次
   python smart_import.py --batch 85
   
   # 指定商品分类
   python smart_import.py --category "刻字马克杯"
   
   # 限制导入数量
   python smart_import.py --limit 10
   ```

2. **分类管理工具**
   ```bash
   # 运行分类管理工具
   python organize_categories.py
   
   # 通过交互式菜单:
   # 1. 创建/更新分类结构
   # 2. 查看现有分类
   # 3. 将现有杯子商品分配到正确分类
   ```

### 注意事项

1. 确保Django环境正确配置，脚本依赖Django模型
2. 图片路径默认为`/Users/jimmu/mall/scraper/scraped_data/amazon/images`，使用前请检查路径是否正确
3. 商品价格默认以美元计价，导入后显示为美元价格
4. 在导入大量数据前，建议先使用`--preview`和`--limit`选项测试

### 未来计划

1. 开发Web界面，支持可视化导入和分类管理
2. 增加更多智能分类规则，提高分类准确率
3. 支持更多商品属性的自动提取和分析
4. 优化图片处理，支持自动裁剪和优化 